<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minew G1-E LED Status Prototype</title>
  <style>
    body { 
      font-family: sans-serif; 
      text-align: center; 
      margin: 20px; 
      background-color: #121212; 
      color: #EEEEEE;
    }
    #led-ring { position: relative; width: 300px; height: 300px; margin: 20px auto; }
    .led {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #000;
      transition: background 0.3s, opacity 0.3s;
    }
    @keyframes rotate-sweep {
      0% { background: rgba(255,255,255,0.1); }
      50% { background: rgba(255,255,255,0.8); }
      100% { background: rgba(255,255,255,0.1); }
    }
    @keyframes blink-1hz {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    @keyframes blink-5hz {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    @keyframes strobe-10hz {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    .rotate { animation: rotate-sweep 2s linear infinite; }
    .blink-1hz { animation: blink-1hz 1s step-end infinite; }
    .blink-5hz { animation: blink-5hz 0.2s step-end infinite; }
    .strobe-10hz { animation: strobe-10hz 0.1s step-end infinite; }
    #controls select,
    #controls button {
      padding: 8px;
      margin: 5px;
      background-color: #333;
      color: #EEE;
      border: 1px solid #555;
      border-radius: 4px;
    }
    #controls button:hover { background-color: #444; }
    #scenarios button {
      padding: 6px 12px;
      margin: 4px;
      background: #222;
      color: #EEE;
      border: 1px solid #555;
      border-radius: 4px;
    }
    #scenarios button:hover { background: #333; }
  </style>
</head>
<body>
  <h1>Minew G1-E LED Status Prototype</h1>
  <p>Trigger LED states via the <strong>State selector</strong> or run <strong>Scenarios</strong> below.</p>
  <div id="led-ring"></div>
  <div id="controls">
    <select id="state-select">
      <option value="OFF">Power Off</option>
      <option value="BOOTLOADER">Bootloader</option>
      <option value="BOOTING">System Booting</option>
      <option value="BACNET_SW_UPDATE">Updating BACnet Software (USB)</option>
      <option value="BACNET_CONFIG_UPDATE">Updating BACnet Config (USB)</option>
      <option value="USB_LOG_BACKUP">Logs Backup to USB (Button)</option>
      <option value="BACNET_SERVICE_STARTED">BACnet Service Started</option>
      <option value="BACNET_REMOTE_CONFIG">Updating BACnet Server Config (Remote)</option>
      <option value="UNPROVISIONED">Unprovisioned</option>
      <option value="PROVISIONED">Provisioned (Idle)</option>
      <option value="FULL_OPERATIONAL">Full Operational</option>
      <option value="LOG_BACKUP_REMOTE">Logs Backup to USB (via BACnet)</option>
      <option value="REMOTE_RESTART">Restarting Silvair Firmware (BACnet)</option>
      <option value="RESET_PRESSED">Reset Button Pressed</option>
      <option value="FACTORY_RESET">Factory Reset</option>
      <option value="BACNET_ERROR_CFG">BACnet Error - File Missing</option>
      <option value="BACNET_ERROR_SYNTAX">BACnet Error - Config Syntax</option>
      <option value="BACNET_ERROR_NORDIC">BACnet Error - Nordic Ping Fail</option>
      <option value="BACNET_ERROR_CRASH">BACnet Error - Crash</option>
    </select>
    <button onclick="applyState(document.getElementById('state-select').value)">Apply State</button>
  </div>
  <div id="scenarios">
    <h3>Scenarios</h3>
    <button onclick="runScenario('boot')">Boot Flow</button>
    <button onclick="runScenario('provision')">Provision Flow</button>
    <button onclick="runScenario('Bacnetrestart')">BACnet restart</button>
    <button onclick="runScenario('reset')">Reset Flow</button>
  </div>
  <script>
    const ring = document.getElementById('led-ring');
    const numLEDs = 24;
    const leds = [];
    let walkInterval, scenarioInterval;
    const radius = 120;

    // Create LED elements
    for (let i = 0; i < numLEDs; i++) {
      const led = document.createElement('div'); led.classList.add('led');
      const angle = (i / numLEDs) * 2 * Math.PI;
      led.style.left = `${radius + Math.cos(angle)*radius - 10}px`;
      led.style.top  = `${radius + Math.sin(angle)*radius - 10}px`;
      ring.appendChild(led);
      leds.push(led);
    }

    // State configurations
    const states = {
      OFF:                { base: '#000', walk:false, anim:'' },
      BOOTLOADER:         { base:'rainbow', walk:false, anim:'' },
      BOOTING:            { base:'#FFF', walk:false, anim:'rotate' },
      BACNET_SW_UPDATE:   { base:'#00F', walk:true,  colorDot:'#FA0', anim:'' },
      BACNET_CONFIG_UPDATE:{ base:'#00F',walk:true, colorDot:'#FF0', anim:'' },
      USB_LOG_BACKUP:     { base:'#800080',walk:true, colorDot:'#FF0', anim:'' },
      BACNET_SERVICE_STARTED:{ base:'#FA0',walk:false, anim:'' },
      BACNET_REMOTE_CONFIG:{ base:'#FA0',walk:true, colorDot:'#00F', anim:'' },
      UNPROVISIONED:      { base:'#FF0', walk:false, anim:'' },
      PROVISIONED:        { base:'#0F0', walk:false, anim:'' },
      FULL_OPERATIONAL:   { base:'#080', walk:false, anim:'' },
      LOG_BACKUP_REMOTE:  { base:'#800080',walk:false, anim:'' },
      REMOTE_RESTART:     { base:'#800080',walk:false, anim:'blink-1hz' },
      RESET_PRESSED:      { base:'#FFF', walk:false, anim:'blink-1hz' },
      FACTORY_RESET:      { base:'#FFF', walk:false, anim:'blink-5hz' },
      BACNET_ERROR_CFG:   { base:'#F00', walk:false, anim:'' },
      BACNET_ERROR_SYNTAX:{ base:'#F00', walk:false, anim:'' },
      BACNET_ERROR_NORDIC:{ base:'#F00', walk:false, anim:'' },
      BACNET_ERROR_CRASH: { base:'#F00', walk:false, anim:'' }
    };

    function clearIntervals() {
      clearInterval(walkInterval);
      clearInterval(scenarioInterval);
    }

    function applyState(name) {
      clearIntervals();
      const cfg = states[name];
      leds.forEach(ld => { ld.className = 'led'; ld.style.opacity = 1; });
      leds.forEach((ld, i) => {
        if (cfg.base === 'rainbow') {
          ld.style.background = `hsl(${(i/numLEDs)*360},100%,50%)`;
        } else {
          ld.style.background = cfg.base;
        }
        ld.baseColor = ld.style.background;
      });
      if (cfg.walk) {
        let pos = 0;
        walkInterval = setInterval(() => {
          leds.forEach(ld => ld.style.background = ld.baseColor);
          leds[pos].style.background = cfg.colorDot;
          pos = (pos + 1) % numLEDs;
        }, 200);
      }
      if (cfg.anim) {
        leds.forEach(ld => ld.classList.add(cfg.anim));
      }
      document.getElementById('state-select').value = name;
    }

    const scenarios = {
      boot:           ['OFF', 'BOOTLOADER', 'BOOTING', 'BACNET_SERVICE_STARTED', 'BACNET_REMOTE_CONFIG', 'BACNET_SERVICE_STARTED','UNPROVISIONED'],
      provision:      ['UNPROVISIONED', 'PROVISIONED', 'FULL_OPERATIONAL'],
      Bacnetrestart:       ['FULL_OPERATIONAL', 'REMOTE_RESTART', 'BACNET_SERVICE_STARTED', 'BACNET_REMOTE_CONFIG', 'BACNET_SERVICE_STARTED','UNPROVISIONED'],
      reset:          ['FULL_OPERATIONAL', 'RESET_PRESSED', 'FACTORY_RESET', 'BOOTLOADER']
    };

    function runScenario(key) {
      const seq = scenarios[key];
      clearIntervals();
      // Recursive timed execution of sequence
      (function nextStep(i) {
        if (i >= seq.length) return;
        applyState(seq[i]);
        setTimeout(() => nextStep(i + 1), 1500);
      })(0);
    }

    // Initialize default state
    applyState('OFF');
  </script>
</body>
</html>
